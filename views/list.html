<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="page-view-size" content="1280*720">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>图文列表</title>
    <link rel="stylesheet" href="../style/common.css">
    <link rel="stylesheet" href="../style/list.css">
</head>
<body>
<!--<div class="subject"></div>-->
<div class="center">
    <div id="title" class="title"></div>
    <div class="preview">
        <img id="preview" src='../images/list/tm.gif' alt="图片轮播" width="500" height="332"/>
    </div>
    <div id="trapper">
        <div id="content" class="content">
        </div>
    </div>
    <div id="pager">

    </div>

</div>

<!--底部-->
<div id="weather-forecast"></div>
<div id="intro-btn-usage"></div>

<div id="self_ad_focus">
    <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
        <tbody>
        <tr>
            <td width="10" height="10"
                style="background:url(../images/focus_lt.png) no-repeat;"></td>
            <td style="background:url(../images/focus_t.png) repeat-x;"></td>
            <td width="10" style="background:url(../images/focus_rt.png) no-repeat;"></td>
        </tr>
        <tr>
            <td style="background:url(../images/focus_l.png) repeat-y;"></td>
            <td>&nbsp;</td>
            <td style="background:url(../images/focus_r.png) repeat-y;"></td>
        </tr>
        <tr>
            <td width="10" height="10" style="background:url(../images/focus_lb.png) no-repeat;"></td>
            <td style="background:url(../images/focus_b.png) repeat-x;"></td>
            <td style="background:url(../images/focus_rb.png) no-repeat;"></td>
        </tr>
        </tbody>
    </table>
</div><!-- self_ad_focus -->
<div id="debug-message"></div>
</body>

<script type="application/javascript" src="../script/async.js"></script>
<script type="application/javascript" src="../script/utility.js"></script>
<script type="application/javascript" src="../script/keyEvent.js"></script>
<script type="application/javascript">
    var preview = {
        position: 0,
        size: 0,
        album: [],

        showAlbum: function () {
            document.getElementById("preview").src = paramObj.imgUrl + this.album[this.position].img;
            document.getElementById("debug-message").innerHTML += "<br/>" + "preview image scr: " + document.getElementById("preview").src;
            document.getElementById("debug-message").innerHTML += "<br/>" + "width: " + document.getElementById("preview").width + " height: " + document.getElementById("preview").height;

            this.position = (this.position + 1) % this.size;
        },

        init: function (imageArray) {
            var that = this;

            this.album = imageArray || this.album;
            this.size = this.album.length;
            preview.showAlbum();
            setInterval(function () {
                that.showAlbum();
            }, 3000);
        }
    };

    var controller = new Controller();

    function Controller() {
        var that = this;

        Assistant.call(this);
        PageHelper.call(this);

        this.backUrl = "";

        this.init = function () {
            transferStation.record();
            that.backUrl = transferStation.backUrl;
//            showTitleForMarquee("为人民服务为人民服务务", document.getElementById("title"), 10);
            ajaxForTitleById(transferStation.itemId);
        };

        this.setParameters = function () {
            that.offset_height = document.getElementById("trapper").offsetHeight;
            that.scroll_height = document.getElementById("content").scrollHeight;
            document.getElementById("debug-message").innerHTML += "<br/>" + "offsetHeight: " + that.offset_height + " scrollHeight: " + that.scroll_height;
            that.total_pages = Math.ceil(that.scroll_height / that.offset_height);
            that.cur_page = 1;
            document.getElementById("pager").innerHTML = that.cur_page + "/" + that.total_pages;
        };

        this.render = function (data) {
            showTitleForMarquee(data.title, document.getElementById("title"), 10);
            document.getElementById("content").innerHTML = data.content;
            preview.init(data.imgArr);

            setTimeout(function () {
                that.setParameters();
            }, 500);
        };

        this.doBack = function () {
            window.location.href = that.backUrl;
        }
    }

    function ajaxForTitleById(id) {
        var _url = paramObj.serverUrl +
                "queryTitleByIdMobile.shtml?id=" + id,
            postman = new Postman();

        document.getElementById("debug-message").innerHTML += "<br/>" + " ==> ajaxForTitleById ";
        document.getElementById("debug-message").innerHTML += "<br/>" + " URL ==> " + _url;

        postman.createXmlHttpRequest(onFetchResourceSuccess, onFetchResourceFail);
        postman.sendRequest('GET', _url, null);
    }

    function onFetchResourceSuccess(html) {
        var json = eval('(' + html + ')');

        $("debug-message").innerHTML += "<br/>" + " ==> onFetchResourceSuccess ";

        if ("1" === json.code || 1 === json.code) {
            controller.render(json);
        }
    }

    function onFetchResourceFail(error) {
        document.getElementById("debug-message").innerHTML += "<br/>" + " ==> onFetchResourceFail ";
        document.getElementById("debug-message").innerHTML += "<br/>" + " Error ==> " + error;
    }

    function grabEvent(_event) {
        var code = Event(_event);
        switch (code) {
            case "KEY_NUMBER1":
                console.info("KEY_NUMBER1");
                controller.toggle();
                return false;
            case "KEY_UP": //
                return false;
            case "KEY_DOWN": //
                return false;
            case "KEY_LEFT": //
                controller.turn(document.getElementById("content"), document.getElementById("pager"), -1);
                return false;
            case "KEY_RIGHT": //
                controller.turn(document.getElementById("content"), document.getElementById("pager"), 1);
                return false;
            case "KEY_PAGE_UP": //
                controller.turn(document.getElementById("content"), document.getElementById("pager"), -1);
                return false;
            case "KEY_PAGE_DOWN": //
                controller.turn(document.getElementById("content"), document.getElementById("pager"), 1);
                return false;
            case "KEY_SELECT": //
//                oparateObj.doSelect();
                return false;
            case "KEY_EXIT":
            case "KEY_BACK":
                controller.doBack();
                return false;
            default:
                break;
        }
    }
    document.onkeydown = grabEvent;
    window.onload = controller.init();
</script>
</html>