<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="page-view-size" content="1280*720">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>首页</title>
    <link rel="stylesheet" href="../style/common.css">
    <link rel="stylesheet" href="../style/index.css">
</head>

<body>

<div id="index-logo" class="title-logo"
     style="background: url('../images/index/index_logo.png') no-repeat; "></div>

<div class="row">
    <div class="post-entry">
        <div id="example-post-1" class="example-post">
            <img id="post-item-0" src="../images/post-1.jpg" width="353px" height="300px" alt="海报">
        </div>
        <div id="example-post-2" class="example-post">
            <img id="post-item-1" src="../images/post-2.jpg" width="500px" height="300px" alt="海报">
            <!--<img id="icon_video_play" src="../images/video_play.PNG" width="73" height="71">-->
        </div>
    </div>

    <div id="index_notices_board">
        <div class="politics_notices_board_bar"
             style="background: url(../images/list-item-bar.png) no-repeat; width: 380px; height: 40px;"></div>
        <div id="list_menu_0" class="index_list_item" style="top: 50px;">
            <div class="index_list_item_text"></div>
        </div>
        <div id="list_menu_1" class="index_list_item" style="top: 85px;">
            <div class="index_list_item_text"></div>
        </div>
        <div id="list_menu_2" class="index_list_item" style="top: 120px;">
            <div class="index_list_item_text"></div>
        </div>
        <div id="list_menu_3" class="index_list_item" style="top: 155px;">
            <div class="index_list_item_text"></div>
        </div>
        <div id="list_menu_4" class="index_list_item" style="top: 190px;">
            <div class="index_list_item_text"></div>
        </div>
        <div id="index_list-item-more"
             style="background: url(../images/list-item-more.png) no-repeat; width: 126px; height: 18px;"></div>
    </div>
</div><!--  row  -->

<div id="btn-item-0" class="btn-entry-item" style="left: 74px">
    <img id="item-img-0" alt="btn-intro" src="../images/btn-intro-disable.png"/>
</div>
<div id="btn-item-1" class="btn-entry-item" style="left: 235px">
    <img id="item-img-1" alt="btn-peace" src="../images/btn-peace-disable.png"/>
</div>
<div id="btn-item-2" class="btn-entry-item" style="left: 396px">
    <img id="item-img-2" alt="btn-affairs" src="../images/btn-affairs-disable.png"/>
</div>
<div id="btn-item-3" class="btn-entry-item" style="left: 557px">
    <img id="item-img-3" alt="btn-building" src="../images/btn-building-disable.png"/>
</div>
<div id="btn-item-4" class="btn-entry-item" style="left: 718px">
    <img id="item-img-4" alt="btn-culture" src="../images/btn-culture-disable.png"/>
</div>
<div id="btn-item-5" class="btn-entry-item" style="left: 879px">
    <img id="item-img-5" alt="btn-public" src="../images/btn-public-disable.png"/>
</div>
<div id="btn-item-6" class="btn-entry-item" style="left: 1040px">
    <img id="item-img-6" alt="btn-service" src="../images/btn-service-disable.png"/>
</div>

<div id="weather-forecast"></div>
<div id="intro-btn-usage"></div>

<div id="self_ad_focus">
    <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
        <tbody>
        <tr>
            <td width="10" height="10"
                style="background:url(../images/focus_lt.png) no-repeat;"></td>
            <td style="background:url(../images/focus_t.png) repeat-x;"></td>
            <td width="10" style="background:url(../images/focus_rt.png) no-repeat;"></td>
        </tr>
        <tr>
            <td style="background:url(../images/focus_l.png) repeat-y;"></td>
            <td>&nbsp;</td>
            <td style="background:url(../images/focus_r.png) repeat-y;"></td>
        </tr>
        <tr>
            <td width="10" height="10" style="background:url(../images/focus_lb.png) no-repeat;"></td>
            <td style="background:url(../images/focus_b.png) repeat-x;"></td>
            <td style="background:url(../images/focus_rb.png) no-repeat;"></td>
        </tr>
        </tbody>
    </table>
</div><!-- self_ad_focus -->
<div id="debug-message"></div>
</body>

<!--<script type="application/javascript" src="../script/ajax.js"></script>-->
<script type="application/javascript" src="../script/async.js"></script>
<script type="application/javascript" src="../script/utility.js"></script>
<script type="application/javascript" src="../script/keyEvent.js"></script>
<script type="application/javascript">

    var menuObj = {

            focusPos: 0,
            focusItemName: "",                // 记录光标定位的元素名称
            menuPosArray: [
                {left: 74, top: 462, width: 141, height: 142},
                {left: 235, top: 462, width: 141, height: 142},
                {left: 396, top: 462, width: 141, height: 142},
                {left: 557, top: 462, width: 141, height: 142},
                {left: 718, top: 462, width: 141, height: 142},
                {left: 879, top: 462, width: 141, height: 142},
                {left: 1040, top: 462, width: 141, height: 142}
            ]
            ,
            menuItemArray: null,

            init: function () {

                this.menuItemArray = [];
                this.menuItemArray.push({
                    name: "index_intro",
                    url: ""
                })
                ;
                this.menuItemArray.push({
                    name: "index_politics",
                    url: "peace.html?focusArea=0&focusPos=1"
                });
                this.menuItemArray.push({
                    name: "index_affairs",
                    url: "affairs.html?focusArea=0&focusPos=2"
                });
                this.menuItemArray.push({
                    name: "index_building",
//                    url: "http://10.215.0.141/fujiandangjian/shipinhuiyi/qgdyyj/index.html?cId=788&IP=192.168.12.65&port=8080"
                    url: "building.html?focusArea=0&focusPos=3"
                });
                this.menuItemArray.push({
                    name: "index_city",
                    url: "city.html?focusArea=0&focusPos=4"
                });
                this.menuItemArray.push({
                    name: "index_public",
                    url: "http://10.184.255.4:8080/portal2/ggsy.html"
                });
                this.menuItemArray.push({
                    name: "index_service",
                    url: "service.html?focusArea=0&focusPos=6"
                });

            }
            ,

            focusOn: function () {
                var _imgNode,
                    _imgSrc;
                console.info("menuObj ==> focusOn ==> " + this.focusPos);

                _imgNode = document.getElementById("item-img-" + this.focusPos);
                _imgSrc = "../images/" + _imgNode.alt + ".png";
                _imgNode.src = _imgSrc;
            }
            ,

            focusOut: function () {
                var _imgNode,
                    _imgSrc;
                console.info("menuObj ==> focusOut ==> " + this.focusPos);

                _imgNode = document.getElementById("item-img-" + this.focusPos);
                _imgSrc = "../images/" + _imgNode.alt + "-disable.png";
                _imgNode.src = _imgSrc;
            }
            ,

            moveX: function (_direction) {

                console.info("menuObj ==> moveX");

                this.focusOut();

                menuObj.focusPos += _direction;

                if (menuObj.focusPos >= 0 && menuObj.focusPos < menuObj.menuPosArray.length) {

                } else if (menuObj.focusPos < 0) {
                    menuObj.focusPos = menuObj.menuPosArray.length - 1;
                } else {
                    menuObj.focusPos = 0;
                }

                this.focusOn();
            }
            ,

            moveY: function (_direction) {

                this.focusOut();

                controller.focusArea = 1;     // 光标定位在菜单区域,上下移动光标都到海报区域
                postObj.focusOn();

            }
            ,

            doSelect: function () {

                var that = this,
                    postman,
                    link = this.menuItemArray[this.focusPos].url,
                    _url = paramObj.serverUrl +
                        "queryTitleListMobile.shtml?resourceId=" + paramObj.introResourceIdArray[1].resourceId + "&num=1&cur_page=1";

                // 走进拱辰
                if (this.menuItemArray[this.focusPos].name === "index_intro") {
                    postman = new Postman();

                    document.getElementById("debug-message").innerHTML += "<br/>" + "[AJAX] URL ==> " + _url;

                    postman.createXmlHttpRequest(
                        function (html) {
                            var json = eval('(' + html + ')');

                            if ("1" === json.code || 1 === json.code) {
                                if (json.hasOwnProperty("dataArray") && json.dataArray.length > 0) {
                                    window.location.href = "text.html?itemId=" + json.dataArray[0].id
                                        + "&backUrl=" + encodeURIComponent(window.location.href + "?focusArea=0&focusPos=0")
                                }
                            }
                        },
                        function () {
                            document.getElementById("debug-message").innerHTML += "<br/>" + "[AJAX] ==> onFetchResourceFail ";
                            document.getElementById("debug-message").innerHTML += "<br/>" + " Error ==> " + error;
                        });

                    postman.sendRequest('GET', _url, null);

                }
                else if (this.menuItemArray[this.focusPos].name === "index_building") {
                    if ("" !== link) {
//                        GlobalVarManager.setItemStr("dj_app_backUrl",window.location.href);
                        window.location.href = link;
                    }
                }
                else {
                    if ("" !== link) {
                        window.location.href = link;
                    }
                }

            }
        },

        postObj = new PostObj(),

        listObj = new ListObj(),

        controller = new Controller();

    function Controller() {
        var that = this;

        Assistant.call(this);

        this.focusArea = 1;                   // 当前光标所在区域

        this.init = function () {
            menuObj.init();                 // 初始化菜单项
            postObj.init();                 // 初始化海报
            listObj.init();                 // 初始化列表项

            var params = parseRequestUrl();    // 解析URL链接，得到区域及位置参数

            if (params.hasOwnProperty("focusArea")) {
                console.info("==>   focusArea = " + params["focusArea"]);
                that.focusArea = parseInt(params["focusArea"]);
                document.getElementById("debug-message").innerHTML += "<br/>" + "Set focus Area ==> " + that.focusArea;
            }

            if (params.hasOwnProperty("focusPos")) {
                console.info("==>   focusPos = " + params["focusPos"]);
                switch (that.focusArea) {
                    case 0:
                        menuObj.focusPos = parseInt(params["focusPos"]);
                        break;
                    case 1:
                        postObj.focusPos = parseInt(params["focusPos"]);
                        break;
                    case 2:
                        that.focusArea = 1;             // 列表项异步提取 返回后光标方可定位 初始化先定位至海报区
                        listObj.focusPos = parseInt(params["focusPos"]);
                        break;
                    default:
                        break;
                }
                document.getElementById("debug-message").innerHTML += "<br/>" + "Set focus position ==> " + parseInt(params["focusPos"]);
            }
            this.focusOn();                 // 光标定位至目标位置
        };


        this.focusOn = function () {
            document.getElementById("debug-message").innerHTML += "<br/>" + " Focus on ==> " + that.focusArea;
            switch (that.focusArea) {
                case 0:             // 菜单
                    menuObj.focusOn();
                    break;
                case 1:             // 海报
                    postObj.focusOn();
                    break;
                case 2:             // 文字列表
                    listObj.focusOn();
                    break;
                default:
                    break;
            }
        };

        this.focusOut = function () {

        };

        this.moveX = function (_direction) {

            console.info("controller ==> moveX " + _direction);

            switch (that.focusArea) {
                case 0:             // 菜单
                    menuObj.moveX(_direction);
                    break;
                case 1:             // 海报
                    postObj.moveX(_direction);
                    break;
                case 2:             // 文字列表
                    listObj.moveX(_direction);
                    break;
                default:
                    break;
            }
        };

        this.moveY = function (_direction) {

            switch (that.focusArea) {
                case 0:             // 菜单
                    menuObj.moveY(_direction);
                    break;
                case 1:             // 海报
                    postObj.moveY(_direction);
                    break;
                case 2:             // 文字列表
                    listObj.focusOut();
                    listObj.moveY(_direction);
                    break;
                default:
                    break;
            }
        };

        this.doSelect = function () {

            switch (that.focusArea) {
                case 0:             // 菜单
                    menuObj.doSelect();
                    break;
                case 1:             // 海报
                    postObj.doSelect();
                    break;
                case 2:             // 文字列表
                    listObj.doSelect(listObj.focusPos, "index");
                    break;
                default:
                    break;
            }
        };

        this.doBack = function () {
            if ("undefined" !== typeof(GlobalVarManager)) {
                window.location.href = GlobalVarManager.getItemStr("tvPortalUrl");
            }
//                window.history.back();
//                window.location.href = "http://10.184.255.11:80/ptmlxc/index.htm";  // 美丽乡村列表页
//                window.location.href = paramObj.backUrl;
        }
    }

    function PostObj() {
        var that = this;

        PostHelper.call(this);

        this.postItemArray = [
            {
                left: 22,
                top: 134,
                width: 356,
                height: 302,
                resourceId: paramObj.indexResourceIdArray[1].resourceId,
                element: "post-item-0",
                url: ""
            },

            {
                left: 376,
                top: 134,
                width: 505,
                height: 302,
                resourceId: paramObj.indexResourceIdArray[2].resourceId,
                element: "post-item-1",
                url: ""
            }
        ];

        this.moveX = function (_direction) {

            this.focusOut();
            this.focusPos += _direction;
            if (this.focusPos >= 0 && this.focusPos < this.postItemArray.length) {
                this.focusOn();
            } else if (this.focusPos < 0) {
                if (listObj.listItemTitleArray.length > 0) {
                    this.focusPos = 0;
                    controller.focusArea = 2;
                    listObj.focusOn();
                } else {
                    this.focusPos = this.postItemArray.length - 1;
                    this.focusOn();
                }
            } else {
                if (listObj.listItemTitleArray.length > 0) {
                    this.focusPos = this.postItemArray.length - 1;
                    controller.focusArea = 2;
                    listObj.focusOn();
                } else {
                    this.focusPos = 0;
                    this.focusOn();
                }
            }
        };

        this.moveY = function (_direction) {

            this.focusOut();

            controller.focusArea = 0;
            menuObj.focusOn();
        }
    }

    function ListObj() {
        // 复制ListHelper的实例属性
        ListHelper.call(this);

        // 属性
        this.focusPos = 0;
        this.listItemNum = 5;

        this.resourceId = paramObj.indexResourceIdArray[3].resourceId;

        // 方法
        this.moveX = function (_direction) {
            this.focusOut();
            if (_direction < 0) {
                postObj.focusPos = postObj.postItemArray.length - 1;
            } else {
                postObj.focusPos = 0;
            }
            controller.focusArea = 1;
            postObj.focusOn();
        };

        this.moveY = function (_direction) {
            this.focusOut();
            this.focusPos += _direction;
            if (this.focusPos >= 0 && this.focusPos < this.listItemTitleArray.length) {
                this.focusOn();
            } else if (this.focusPos < 0) {
                this.focusPos = 0;
                controller.focusArea = 0;
                menuObj.focusOn();
            } else {
                this.focusPos = this.listItemTitleArray.length - 1;
                controller.focusArea = 0;
                menuObj.focusOn();
            }
        };
    }

    function grabEvent(_event) {

        var code = Event(_event);

        switch (code) {
//            case "KEY_NUMBER1":
//                console.info("KEY_NUMBER1");
//                controller.toggle();
//                return false;
            case "KEY_UP": //
                controller.moveY(-1);
                return false;
            case "KEY_DOWN": //
                controller.moveY(1);
                return false;
            case "KEY_LEFT": //
                controller.moveX(-1);
                return false;
            case "KEY_RIGHT": //
                controller.moveX(1);
                return false;
            case "KEY_PAGE_UP": //
//                controller.changePage(-1);
                return false;
            case "KEY_PAGE_DOWN": //
//                controller.changePage(1);
                return false;
            case "KEY_SELECT": //
                controller.doSelect();
                return false;
            case "KEY_EXIT":
            case "KEY_BACK":
                controller.doBack();
                return false;
            default:
                break;
        }
    }

    document.onkeydown = grabEvent;
    window.onload = controller.init();

</script>
</html>